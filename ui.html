<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Hoot Spotter</title>
</head>
<body>
  <h2>Hoot Spotter ğŸ¦‰</h2>
  <button id="set-control">Set Control</button>
  <button id="set-references">Set References</button>
  <button id="run-scan">Run Scan</button>
  <button id="close">Close Plugin</button>

  <div id="results" style="margin-top: 20px;"></div>

  <script>
    document.getElementById("set-control").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "set-control" } }, "*");
    };

    document.getElementById("set-references").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "set-references" } }, "*");
    };

    document.getElementById("run-scan").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "run-scan" } }, "*");
    };

    document.getElementById("close").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "close-plugin" } }, "*");
    };

    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg.type === "scan-complete") {
        const container = document.getElementById("results");
        container.innerHTML = ""; // Clear previous

        msg.payload.forEach((entry) => {
          const title = document.createElement("h3");
          title.textContent = entry.name;
          container.appendChild(title);

          if (entry.results.length === 0) {
            const warning = document.createElement("p");
            warning.textContent = "âš ï¸ No comparable properties.";
            container.appendChild(warning);
            return;
          }

          entry.results.forEach((r) => {
            const row = document.createElement("p");

            // Build content with optional ğŸ“ button
            row.innerHTML = `${r.match ? "âœ…" : "âŒ"} ${r.prop} on "${r.controlLayer}" â†’ ${r.detail}`
              + (r.nodeId ? ` <button data-nodeid="${r.nodeId}">ğŸ“</button>` : "");

            container.appendChild(row);
          });
        });
      }
    };

    // Listen for ğŸ“ button clicks
    document.addEventListener("click", (e) => {
      if (e.target.tagName === "BUTTON" && e.target.dataset.nodeid) {
        const nodeId = e.target.dataset.nodeid;
        parent.postMessage({ pluginMessage: { type: "focus-node", nodeId } }, "*");
      }
    });
  </script>
</body>
</html>
