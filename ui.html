<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Hoot Spotter</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    h2 {
      margin-bottom: 10px;
    }
    button {
      margin: 5px 10px 5px 0;
      padding: 6px 10px;
    }
    .result-group {
      border-top: 1px solid #ddd;
      margin-top: 20px;
      padding-top: 10px;
    }
    .result-row {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }
    .focus-button {
      margin-left: 6px;
      cursor: pointer;
      background: none;
      border: none;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <h2>Hoot Spotter 🦉</h2>
  <button id="set-control">Set Control</button>
  <button id="set-references">Set References</button>
  <button id="run-scan">Run Scan</button>
  <button id="close">Close Plugin</button>

  <div id="results"></div>

  <script>
    document.getElementById("set-control").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "set-control" } }, "*");
    };

    document.getElementById("set-references").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "set-references" } }, "*");
    };

    document.getElementById("run-scan").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "run-scan" } }, "*");
    };

    document.getElementById("close").onclick = () => {
      parent.postMessage({ pluginMessage: { type: "close-plugin" } }, "*");
    };

    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg.type === "scan-complete") {
        const container = document.getElementById("results");
        container.innerHTML = ""; // Clear previous

        msg.payload.forEach((entry) => {
          const group = document.createElement("div");
          group.className = "result-group";

          const title = document.createElement("h3");
          title.textContent = entry.name;
          group.appendChild(title);

          if (entry.results.length === 0) {
            const warning = document.createElement("p");
            warning.textContent = "⚠️ No comparable properties.";
            group.appendChild(warning);
          } else {
            entry.results.forEach((r) => {
              const row = document.createElement("div");
              row.className = "result-row";

              const icon = r.match ? "✅" : "❌";
              const text = document.createTextNode(
                `${icon} ${r.prop} on "${r.controlLayer}" → ${r.detail}`
              );

              row.appendChild(text);

              // 🎯 Add focus button
              const focusBtn = document.createElement("button");
              focusBtn.className = "focus-button";
              focusBtn.title = "Focus in Figma";
              focusBtn.textContent = "🎯";
              focusBtn.onclick = () => {
                parent.postMessage(
                  { pluginMessage: { type: "focus-node", nodeId: r.nodeId } },
                  "*"
                );
              };

              row.appendChild(focusBtn);
              group.appendChild(row);
            });
          }

          container.appendChild(group);
        });
      }
    };
  </script>
</body>
</html>
